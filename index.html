<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Festival API - Dashboard</title>
    <style>
        /* =================================================================
           NOVO TEMA: LARANJA, PRETO E BRANCO
           CSS 100% original, sem base no projeto anterior.
           ================================================================= */
        :root {
            --bg-dark: #121212;
            --bg-card: #1E1E1E;
            --bg-modal: #242424;
            --text-light: #f5f5f5;
            --text-muted: #888888;
            --accent-orange: #F97316;
            --accent-orange-dark: #EA580C;
            --border-color: #333333;
            --error-red: #ef4444;
            --success-green: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* --- Header --- */
        .header {
            text-align: center;
            padding: 2rem 1rem;
            border-bottom: 3px solid var(--accent-orange);
        }
        .header h1 {
            color: var(--text-light);
            font-size: 2.5rem;
            font-weight: 700;
        }
        .header h1 span {
            color: var(--accent-orange);
        }
        .header p {
            color: var(--text-muted);
            font-size: 1rem;
        }

        /* --- Barra da API Key --- */
        .api-bar {
            background: var(--bg-card);
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .api-bar label {
            font-weight: 600;
            color: var(--accent-orange);
        }
        .api-bar input {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            min-width: 350px;
            font-size: 0.9rem;
        }
        .api-bar input:focus {
            outline: none;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 2px var(--accent-orange-dark);
        }

        /* --- Navegação --- */
        .nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding: 1.5rem;
            background: var(--bg-dark);
            border-bottom: 1px solid var(--border-color);
        }

        /* --- Botões --- */
        .btn {
            padding: 0.6rem 1.25rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s ease-in-out;
            border: 2px solid var(--accent-orange);
            background: transparent;
            color: var(--accent-orange);
        }
        .btn:hover {
            background: var(--accent-orange);
            color: var(--text-light);
            transform: translateY(-2px);
        }
        .btn.nav-btn.active {
            background: var(--accent-orange);
            color: var(--text-light);
        }
        .btn-primary {
            background: var(--accent-orange);
            color: var(--text-light);
        }
        .btn-primary:hover {
            background: var(--accent-orange-dark);
            border-color: var(--accent-orange-dark);
        }
        .btn-secondary {
            border-color: var(--text-muted);
            color: var(--text-muted);
        }
        .btn-secondary:hover {
            background: var(--text-muted);
            color: var(--bg-dark);
        }
        .btn-danger {
            border-color: var(--error-red);
            color: var(--error-red);
        }
        .btn-danger:hover {
            background: var(--error-red);
            color: var(--text-light);
        }

        /* --- Barra de Busca --- */
        .search-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .search-input {
            flex: 1;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 0.75rem 1rem;
            border-radius: 6px;
            font-size: 1rem;
        }
        .search-input:focus {
            outline: none;
            border-color: var(--accent-orange);
        }

        /* --- Grid & Cards --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-orange);
        }
        .card-header {
            padding: 1.25rem 1.5rem 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .card-header h3 {
            color: var(--accent-orange);
            font-size: 1.4rem;
            margin-bottom: 0.25rem;
        }
        .card-status {
            background: var(--border-color);
            color: var(--text-light);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.6rem;
            border-radius: 20px;
            white-space: nowrap;
        }
        .card-status.status-pago { background: var(--success-green); }
        .card-status.status-esgotado { background: var(--error-red); }
        .card-status.status-disponivel { background: var(--accent-orange); }

        .card-body {
            padding: 0 1.5rem 1rem;
            color: var(--text-muted);
        }
        .card-body p {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .card-body strong {
            color: var(--text-light);
        }
        .card-footer {
            padding: 1rem 1.5rem;
            background: var(--bg-dark);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* --- Modal --- */
        .modal-backdrop {
            display: none;
            position: fixed;
            inset: 0; /* top/left/right/bottom = 0 */
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            backdrop-filter: blur(5px);
        }
        .modal-backdrop.active {
            display: flex;
        }
        .modal-content {
            background: var(--bg-modal);
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border-top: 4px solid var(--accent-orange);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        .modal-title {
            font-size: 1.75rem;
            color: var(--accent-orange);
        }
        .close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 2rem;
            cursor: pointer;
            line-height: 1;
        }
        .close-btn:hover {
            color: var(--text-light);
        }
        .modal-body {
            padding: 1.5rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-light);
            font-weight: 600;
        }
        .form-input, .select-input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            color: var(--text-light);
            border-radius: 6px;
            font-size: 1rem;
        }
        .form-input:focus, .select-input:focus {
            outline: none;
            border-color: var(--accent-orange);
        }
        textarea.form-input {
            min-height: 100px;
            resize: vertical;
        }
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* --- Loading Spinner --- */
        .loading-spinner {
            display: none; /* Oculto por padrão */
            justify-content: center;
            align-items: center;
            padding: 4rem;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border-color);
            border-top-color: var(--accent-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* --- Mensagens de Alerta --- */
        #message-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 2000;
            width: 300px;
        }
        .message {
            padding: 1rem;
            border-radius: 6px;
            color: var(--text-light);
            margin-bottom: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }
        .message.success-message { background: var(--success-green); }
        .message.error-message { background: var(--error-red); }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* --- Detalhes (Modal) --- */
        .detail-view { padding: 0.5rem; }
        .detail-section { margin-bottom: 1.25rem; }
        .detail-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--accent-orange);
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }
        .detail-value {
            font-size: 1rem;
            color: var(--text-light);
            line-height: 1.6;
        }

        /* --- Estado Vazio --- */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px dashed var(--border-color);
        }

        /* --- Responsividade --- */
        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .api-bar { flex-direction: column; align-items: stretch; }
            .api-bar input { min-width: auto; }
            .search-bar { flex-direction: column; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    
    <div id="message-container"></div>

    <header class="header">
        <h1>API de Festival <span>//</span></h1>
        <p>Dashboard de Gerenciamento da API Quarkus</p>
    </header>

    <section class="api-bar">
        <label for="apiKeyInput">Sua Chave de API:</label>
        <input type="password" id="apiKeyInput" placeholder="Insira sua API Key..." value="demo_key_123456">
        <button class="btn" onclick="saveApiKey()">Salvar & Carregar</button>
    </section>

    <nav class="nav">
        <button class="btn nav-btn active" onclick="changeSection('eventos')">Eventos</button>
        <button class="btn nav-btn" onclick="changeSection('artistas')">Artistas</button>
        <button class="btn nav-btn" onclick="changeSection('ingressos')">Ingressos</button>
    </nav>

    <main class="container">
        <section class="search-bar">
            <input type="text" id="searchInput" class="search-input" placeholder="Buscar por nome, email, etc...">
            <button class="btn" onclick="searchData()">🔍 Buscar</button>
            <button class="btn btn-primary" onclick="openCreateModal()">➕ Criar Novo</button>
        </section>

        <div id="loading-spinner" class="loading-spinner">
            <div class="spinner"></div>
        </div>
        <div id="content-grid" class="grid">
            </div>
    </main>

    <div id="modal-backdrop" class="modal-backdrop" onclick="closeModalOnBackdrop(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title" class="modal-title">Modal</h2>
                <button class="close-btn" onclick="closeModal()">×</button>
            </div>
            <div id="modal-body" class="modal-body">
                </div>
        </div>
    </div>

    <script>
        // =================================================================
        //                 JAVASCRIPT (LÓGICA DA API QUARKUS)
        // =l================================================================
        // Este JS é o mesmo da solução anterior,
        // apenas ajustado para os novos IDs e Classes do CSS.
        
        const API_BASE = 'http://localhost:8080/api/v1';
        let API_KEY = 'demo_key_123456'; // Padrão com a chave de teste

        let state = {
            currentSection: 'eventos',
            currentSearch: '',
        };

        function saveApiKey() {
            const newKey = document.getElementById('apiKeyInput').value;
            if (newKey) {
                API_KEY = newKey;
                showMessage('API Key salva! Carregando dados...', 'success');
                loadData();
            } else {
                showMessage('API Key não pode estar vazia.', 'error');
            }
        }
        
        async function fetchWithAuth(url, options = {}) {
            if (!API_KEY) {
                showMessage('Erro: API Key não configurada.', 'error');
                throw new Error('API Key não configurada.');
            }

            if (!options.headers) {
                options.headers = {};
            }

            options.headers['X-API-Key'] = API_KEY;
            if (options.body) {
                options.headers['Content-Type'] = 'application/json';
            }

            try {
                const response = await fetch(url, options);
                
                if (response.status === 401 || response.status === 403) {
                    showMessage('Erro de Autenticação (401/403). Verifique sua API Key.', 'error');
                    throw new Error('Não autorizado');
                }
                
                return response;

            } catch (error) {
                if (error.message === 'Failed to fetch') {
                    showMessage('Erro de Rede. A API Quarkus está offline?', 'error');
                }
                throw error;
            }
        }

        function changeSection(section) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            state.currentSection = section;
            state.currentSearch = '';
            document.getElementById('searchInput').value = '';
            
            loadData();
        }

        function searchData() {
            state.currentSearch = document.getElementById('searchInput').value;
            loadData();
        }

        function clearSearch() {
            state.currentSearch = '';
            document.getElementById('searchInput').value = '';
            loadData();
        }

        async function loadData() {
            showLoading(true);
            
            let url = '';
            
            if (state.currentSearch) {
                const searchEndpoints = {
                    eventos: `/eventos/busca/nome/${encodeURIComponent(state.currentSearch)}`,
                    artistas: `/artistas/busca/nome/${encodeURIComponent(state.currentSearch)}`,
                    ingressos: `/ingressos/busca/email/${encodeURIComponent(state.currentSearch)}`
                };
                url = `${API_BASE}${searchEndpoints[state.currentSection]}`;
            } else {
                const endpoints = {
                    eventos: '/eventos',
                    artistas: '/artistas',
                    ingressos: '/ingressos'
                };
                url = `${API_BASE}${endpoints[state.currentSection]}`;
            }

            const contentGrid = document.getElementById('content-grid');
            contentGrid.innerHTML = ''; // Limpa o grid antes de carregar

            try {
                const response = await fetchWithAuth(url);
                if (!response.ok) throw new Error(`Erro ${response.status} na requisição`);
                
                const data = await response.json();
                displayData(data);
                
            } catch (error) {
                if (error.message !== 'Não autorizado') {
                    showMessage('Erro ao carregar dados: ' + error.message, 'error');
                }
                contentGrid.innerHTML = '<div class="empty-state"><h3>Erro ao carregar dados</h3><p>Verifique sua API Key e se a API está no ar.</p></div>';
            } finally {
                showLoading(false);
            }
        }

        function displayData(items) {
            const contentGrid = document.getElementById('content-grid');
            contentGrid.innerHTML = ''; // Limpa de novo por segurança

            if (!items || items.length === 0) {
                contentGrid.innerHTML = '<div class="empty-state"><h3>Nenhum resultado encontrado</h3><p>Tente ajustar sua busca ou crie um novo item.</p></div>';
                return;
            }

            items.forEach(item => {
                const card = createCard(item, state.currentSection);
                contentGrid.appendChild(card);
            });
        }

        // =================================================================
        //           FUNÇÃO createCard (ADAPTADA PARA NOVO CSS)
        // =================================================================
        function createCard(item, type) {
            const card = document.createElement('div');
            card.className = 'card';

            if (type === 'eventos') {
                const dataFormatada = item.dataEvento ? new Date(item.dataEvento).toLocaleDateString('pt-BR') : 'Data não definida';
                let statusClass = item.status ? `status-${item.status.toLowerCase()}` : '';

                card.innerHTML = `
                    <div class="card-header">
                        <h3>${escapeHtml(item.nome)}</h3>
                        ${item.status ? `<span class="card-status ${statusClass}">${escapeHtml(item.status)}</span>` : ''}
                    </div>
                    <div class="card-body">
                        <p><strong>Data:</strong> ${dataFormatada}</p>
                        <p><strong>Local:</strong> ${escapeHtml(item.local || 'N/A')}</p>
                        <p><strong>Preço:</strong> R$ ${item.precoIngresso ? item.precoIngresso.toFixed(2) : '0.00'}</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn" onclick="viewDetails(${item.id}, 'eventos')">👁 Ver</button>
                        <button class="btn btn-secondary" onclick="editItem(${item.id}, 'eventos')">✏ Editar</button>
                    </div>
                `;
            } else if (type === 'artistas') {
                card.innerHTML = `
                    <div class="card-header">
                        <h3>${escapeHtml(item.nome)}</h3>
                        ${item.generoMusical ? `<span class="card-status">${escapeHtml(item.generoMusical)}</span>` : ''}
                    </div>
                    <div class="card-body">
                        <p>${escapeHtml(item.biografia || 'Sem biografia')}</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn" onclick="viewDetails(${item.id}, 'artistas')">👁 Ver</button>
                        <button class="btn btn-secondary" onclick="editItem(${item.id}, 'artistas')">✏ Editar</button>
                    </div>
                `;
            } else if (type === 'ingressos') {
                let statusClass = item.status ? `status-${item.status.toLowerCase()}` : '';
                card.innerHTML = `
                    <div class="card-header">
                        <h3>Ingresso #${item.id}</h3>
                        ${item.status ? `<span class="card-status ${statusClass}">${escapeHtml(item.status)}</span>` : ''}
                    </div>
                    <div class="card-body">
                         <p><strong>Comprador:</strong> ${escapeHtml(item.nomeComprador)}</p>
                         <p><strong>Email:</strong> ${escapeHtml(item.emailComprador)}</p>
                         <p><strong>Qtd:</strong> ${item.quantidade} / <strong>Total:</strong> R$ ${item.precoTotal ? item.precoTotal.toFixed(2) : '0.00'}</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn" onclick="viewDetails(${item.id}, 'ingressos')">👁 Ver</button>
                        <button class="btn btn-secondary" onclick="editItem(${item.id}, 'ingressos')">✏ Editar</button>
                    </div>
                `;
            }

            return card;
        }

        async function viewDetails(id, type) {
            const endpoints = {
                eventos: '/eventos',
                artistas: '/artistas',
                ingressos: '/ingressos'
            };

            try {
                const response = await fetchWithAuth(`${API_BASE}${endpoints[type]}/${id}`);
                if (!response.ok) throw new Error('Erro ao carregar detalhes');
                const item = await response.json();
                
                document.getElementById('modal-title').textContent = item.nome || `Ingresso #${item.id}`;
                document.getElementById('modal-body').innerHTML = createDetailView(item, type);
                document.getElementById('modal-backdrop').classList.add('active');
            } catch (error) {
                showMessage('Erro ao carregar detalhes: ' + error.message, 'error');
            }
        }

        // =================================================================
        //           VISUALIZAÇÃO DE DETALHES (ADAPTADA PARA NOVO CSS)
        // =================================================================
        function createDetailView(item, type) {
            let html = '<div class="detail-view">';

            if (type === 'eventos') {
                const dataFormatada = item.dataEvento ? new Date(item.dataEvento).toLocaleDateString('pt-BR') : 'N/A';
                html += `
                    <div class="detail-section">
                        <div class="detail-label">Nome</div>
                        <div class="detail-value">${escapeHtml(item.nome)}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Data</div>
                        <div class="detail-value">${dataFormatada}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Descrição</div>
                        <div class="detail-value">${escapeHtml(item.descricao || 'Sem descrição')}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Local</div>
                        <div class="detail-value">${escapeHtml(item.local || 'N/A')}</div>
                    </div>
                     <div class="detail-section">
                        <div class="detail-label">Capacidade / Preço</div>
                        <div class="detail-value">${item.capacidadeMaxima.toLocaleString('pt-BR')} pessoas / R$ ${item.precoIngresso.toFixed(2)}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">${escapeHtml(item.status)}</div>
                    </div>
                    ${item.artistas && item.artistas.length > 0 ? `
                    <div class="detail-section">
                        <div class="detail-label">Artistas (${item.artistas.length})</div>
                        <div class="detail-value">${item.artistas.map(a => escapeHtml(a.nome || `ID: ${a.id}`)).join(', ')}</div>
                    </div>` : ''}
                `;
            } else if (type === 'artistas') {
                html += `
                    <div class="detail-section">
                        <div class="detail-label">Nome</div>
                        <div class="detail-value">${escapeHtml(item.nome)}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Gênero Musical</div>
                        <div class="detail-value">${escapeHtml(item.generoMusical || 'N/A')}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Biografia</div>
                        <div class="detail-value">${escapeHtml(item.biografia || 'Sem biografia')}</div>
                    </div>
                `;
            } else if (type === 'ingressos') {
                 const dataCompraFormatada = item.dataCompra ? new Date(item.dataCompra).toLocaleString('pt-BR') : 'N/A';
                html += `
                    <div class="detail-section">
                        <div class="detail-label">Evento</div>
                        <div class="detail-value">${escapeHtml(item.evento ? item.evento.nome : 'Evento ID: ' + item.eventoId)}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Comprador</div>
                        <div class="detail-value">${escapeHtml(item.nomeComprador)} (${escapeHtml(item.emailComprador)})</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Data da Compra</div>
                        <div class="detail-value">${dataCompraFormatada}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Status</div>
                        <div class="detail-value">${escapeHtml(item.status)}</div>
                    </div>
                    <div class="detail-section">
                        <div class="detail-label">Quantidade / Preço Total</div>
                        <div class="detail-value">${item.quantidade} / R$ ${item.precoTotal.toFixed(2)}</div>
                    </div>
                `;
            }

            html += '</div>';
            return html;
        }

        async function editItem(id, type) {
            const endpoints = {
                eventos: '/eventos',
                artistas: '/artistas',
                ingressos: '/ingressos'
            };

            try {
                const response = await fetchWithAuth(`${API_BASE}${endpoints[type]}/${id}`);
                if (!response.ok) throw new Error('Erro ao carregar item');
                const item = await response.json();
                
                document.getElementById('modal-title').textContent = `Editar ${item.nome || `Ingresso #${item.id}`}`;
                document.getElementById('modal-body').innerHTML = createEditForm(item, type, id);
                document.getElementById('modal-backdrop').classList.add('active');
            } catch (error) {
                showMessage('Erro ao carregar item: ' + error.message, 'error');
            }
        }

        // =================================================================
        //           FORMULÁRIO DE EDIÇÃO (ADAPTADO PARA NOVO CSS)
        // =================================================================
        function createEditForm(item, type, id) {
            // Os formulários da sua API são os mesmos
            const artistasIds = item.artistas ? item.artistas.map(a => a.id).join(', ') : '';
            let formHtml = `<form onsubmit="submitEdit(event, ${id}, '${type}')">`;

            if (type === 'eventos') {
                formHtml += `
                    <div class="form-group">
                        <label class="form-label">Nome:</label>
                        <input type="text" name="nome" class="form-input" value="${escapeHtml(item.nome || '')}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data:</label>
                        <input type="date" name="dataEvento" class="form-input" value="${escapeHtml(item.dataEvento || '')}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descrição:</label>
                        <textarea name="descricao" class="form-input">${escapeHtml(item.descricao || '')}</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Local:</label>
                        <input type="text" name="local" class="form-input" value="${escapeHtml(item.local || '')}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Capacidade Máxima:</label>
                        <input type="number" name="capacidadeMaxima" class="form-input" value="${escapeHtml(item.capacidadeMaxima || '0')}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preço Ingresso:</label>
                        <input type="number" step="0.01" name="precoIngresso" class="form-input" value="${escapeHtml(item.precoIngresso || '0.00')}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">IDs dos Artistas (separados por vírgula):</label>
                        <input type="text" name="artistas" class="form-input" value="${artistasIds}">
                    </div>
                `;
            } else if (type === 'artistas') {
                formHtml += `
                    <div class="form-group">
                        <label class="form-label">Nome:</label>
                        <input type="text" name="nome" class="form-input" value="${escapeHtml(item.nome || '')}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gênero Musical:</label>
                        <input type="text" name="generoMusical" class="form-input" value="${escapeHtml(item.generoMusical || '')}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Biografia:</label>
                        <textarea name="biografia" class="form-input">${escapeHtml(item.biografia || '')}</textarea>
                    </div>
                `;
            } else if (type === 'ingressos') {
                formHtml += `
                    <div class="form-group">
                        <label class="form-label">Nome Comprador:</label>
                        <input type="text" name="nomeComprador" class="form-input" value="${escapeHtml(item.nomeComprador || '')}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Comprador:</label>
                        <input type="email" name="emailComprador" class="form-input" value="${escapeHtml(item.emailComprador || '')}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantidade:</label>
                        <input type="number" name="quantidade" class="form-input" value="${escapeHtml(item.quantidade || '1')}" required>
                    </div>
                     <div class="form-group">
                        <label class="form-label">Status:</label>
                        <select name="status" class="select-input" required>
                            <option value="RESERVADO" ${item.status === 'RESERVADO' ? 'selected' : ''}>RESERVADO</option>
                            <option value="PAGO" ${item.status === 'PAGO' ? 'selected' : ''}>PAGO</option>
                            <option value="CANCELADO" ${item.status === 'CANCELADO' ? 'selected' : ''}>CANCELADO</option>
                            <option value="UTILIZADO" ${item.status === 'UTILIZADO' ? 'selected' : ''}>UTILIZADO</option>
                        </select>
                    </div>
                `;
            }

            formHtml += `
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">💾 Salvar</button>
                </div>
            </form>`;

            return formHtml;
        }

        async function submitEdit(event, id, type) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            let data = {};
            
            if (type === 'eventos') {
                const artistasIDs = formData.get('artistas');
                data = {
                    nome: formData.get('nome'),
                    dataEvento: formData.get('dataEvento') || null,
                    descricao: formData.get('descricao') || null,
                    local: formData.get('local') || null,
                    capacidadeMaxima: parseInt(formData.get('capacidadeMaxima') || 0, 10),
                    precoIngresso: parseFloat(formData.get('precoIngresso') || 0.0),
                    artistas: artistasIDs ? artistasIDs.split(',').map(id => ({ id: parseInt(id.trim()) })).filter(a => !isNaN(a.id)) : []
                };
            } else if (type === 'artistas') {
                data = {
                    nome: formData.get('nome'),
                    generoMusical: formData.get('generoMusical') || null,
                    biografia: formData.get('biografia') || null
                };
            } else if (type === 'ingressos') {
                data = {
                    nomeComprador: formData.get('nomeComprador'),
                    emailComprador: formData.get('emailComprador'),
                    quantidade: parseInt(formData.get('quantidade') || 1, 10),
                    status: formData.get('status')
                };
            }

            const endpoints = {
                eventos: '/eventos',
                artistas: '/artistas',
                ingressos: '/ingressos'
            };

            try {
                const response = await fetchWithAuth(`${API_BASE}${endpoints[type]}/${id}`, {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showMessage('Item atualizado com sucesso!', 'success');
                    closeModal();
                    loadData();
                } else {
                    const errorText = await response.text();
                    showMessage(`Erro ao atualizar: ${errorText || response.statusText}`, 'error');
                }
            } catch (error) {
                showMessage('Erro de conexão: ' + error.message, 'error');
            }
        }

        function openCreateModal() {
            const titles = {
                eventos: 'Criar Novo Evento',
                artistas: 'Criar Novo Artista',
                ingressos: 'Comprar Ingresso'
            };

            document.getElementById('modal-title').textContent = titles[state.currentSection];
            document.getElementById('modal-body').innerHTML = createCreateForm(state.currentSection);
            document.getElementById('modal-backdrop').classList.add('active');
        }

        // =================================================================
        //           FORMULÁRIO DE CRIAÇÃO (ADAPTADO PARA NOVO CSS)
        // =================================================================
        function createCreateForm(type) {
            let html = `<form onsubmit="submitCreate(event, '${type}')">`;

            if (type === 'eventos') {
                html += `
                    <div class="form-group">
                        <label class="form-label">Nome:</label>
                        <input type="text" name="nome" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data:</label>
                        <input type="date" name="dataEvento" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descrição:</label>
                        <textarea name="descricao" class="form-input"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Local:</label>
                        <input type="text" name="local" class="form-input" placeholder="Ex: Praia de Copacabana">
                    </div>
                     <div class="form-group">
                        <label class="form-label">Capacidade Máxima:</label>
                        <input type="number" name="capacidadeMaxima" class="form-input" value="50000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Preço Ingresso:</label>
                        <input type="number" step="0.01" name="precoIngresso" class="form-input" value="250.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">IDs dos Artistas (separados por vírgula):</label>
                        <input type="text" name="artistas" class="form-input" placeholder="Ex: 1, 2, 3">
                    </div>
                `;
            } else if (type === 'artistas') {
                html += `
                    <div class="form-group">
                        <label class="form-label">Nome:</label>
                        <input type="text" name="nome" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gênero Musical:</label>
                        <input type="text" name="generoMusical" class="form-input" placeholder="Ex: Rock, Pop, Eletrônica">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Biografia:</label>
                        <textarea name="biografia" class="form-input"></textarea>
                    </div>
                `;
            } else if (type === 'ingressos') {
                html += `
                    <div class="form-group">
                        <label class="form-label">ID do Evento:</label>
                        <input type="number" name="eventoId" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nome Comprador:</label>
                        <input type="text" name="nomeComprador" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Comprador:</label>
                        <input type="email" name="emailComprador" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantidade:</label>
                        <input type="number" name="quantidade" class="form-input" value="1" required>
                    </div>
                `;
            }

            html += `
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">➕ Criar</button>
                </div>
            </form>`;

            return html;
        }

        async function submitCreate(event, type) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            let data = {};
            
            if (type === 'eventos') {
                const artistasIDs = formData.get('artistas');
                data = {
                    nome: formData.get('nome'),
                    dataEvento: formData.get('dataEvento') || null,
                    descricao: formData.get('descricao') || null,
                    local: formData.get('local') || null,
                    capacidadeMaxima: parseInt(formData.get('capacidadeMaxima') || 0, 10),
                    precoIngresso: parseFloat(formData.get('precoIngresso') || 0.0),
                    artistas: artistasIDs ? artistasIDs.split(',').map(id => ({ id: parseInt(id.trim()) })).filter(a => !isNaN(a.id)) : []
                };
            } else if (type === 'artistas') {
                data = {
                    nome: formData.get('nome'),
                    generoMusical: formData.get('generoMusical') || null,
                    biografia: formData.get('biografia') || null
                };
            } else if (type === 'ingressos') {
                data = {
                    nomeComprador: formData.get('nomeComprador'),
                    emailComprador: formData.get('emailComprador'),
                    quantidade: parseInt(formData.get('quantidade') || 1, 10),
                    eventoId: parseInt(formData.get('eventoId'), 10)
                };
            }

            const endpoints = {
                eventos: '/eventos',
                artistas: '/artistas',
                ingressos: '/ingressos'
            };

            try {
                const response = await fetchWithAuth(`${API_BASE}${endpoints[type]}`, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });

                if (response.ok || response.status === 201) {
                    showMessage('Item criado com sucesso!', 'success');
                    closeModal();
                    loadData();
                } else {
                    const errorText = await response.text();
                    showMessage(`Erro ao criar: ${errorText || response.statusText}`, 'error');
                }
            } catch (error) {
                showMessage('Erro de conexão: ' + error.message, 'error');
            }
        }

        // =================================================================
        //           FUNÇÕES UTILITÁRIAS
        // =================================================================

        function closeModal() {
            document.getElementById('modal-backdrop').classList.remove('active');
        }

        function closeModalOnBackdrop(event) {
            if (event.target.id === 'modal-backdrop') {
                closeModal();
            }
        }

        function showLoading(show) {
            document.getElementById('loading-spinner').style.display = show ? 'flex' : 'none';
            document.getElementById('content-grid').style.display = show ? 'none' : 'grid';
        }

        function showMessage(message, type) {
            const container = document.getElementById('message-container');
            const div = document.createElement('div');
            div.className = `message ${type === 'error' ? 'error-message' : 'success-message'}`;
            div.textContent = message;
            
            container.appendChild(div);

            setTimeout(() => {
                div.style.transition = 'opacity 0.5s ease';
                div.style.opacity = '0';
                setTimeout(() => div.remove(), 500);
            }, 5000);
        }

        function escapeHtml(text) {
            if (typeof text !== 'string') return text;
            const map = {
                '&': '&amp;', '<': '&lt;', '>': '&gt;',
                '"': '&quot;', "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchData();
            }
        });

        // Carregamento inicial
        // Atrasar o primeiro carregamento para dar tempo de inserir a chave, se necessário
        // loadData(); // Descomente se quiser carregar com a chave 'demo'
        showMessage("Insira sua API Key e clique em 'Salvar & Carregar'", 'success');

    </script>
</body>
</html>
