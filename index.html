<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API de Festival - Dashboard</title>
    <style>
        /* O CSS √© o mesmo, apenas com a adi√ß√£o da barra de API Key */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #8b5cf6; --primary-dark: #7c3aed; --secondary: #ec4899;
            --dark: #0f172a; --dark-lighter: #1e293b; --dark-card: #334155;
            --text: #f1f5f9; --text-muted: #94a3b8; --success: #10b981; --error: #ef4444;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-lighter) 100%);
            color: var(--text); min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .header h1 { font-size: 2.5rem; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .header p { text-align: center; margin-top: 0.5rem; opacity: 0.9; }

        /* Nova Barra da API Key */
        .api-key-bar {
            background: var(--dark);
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            border-bottom: 2px solid var(--primary-dark);
        }
        .api-key-bar label { font-weight: 600; color: var(--primary); }
        .api-key-bar input {
            padding: 0.5rem;
            border-radius: 6px;
            border: 2px solid var(--dark-card);
            background: var(--dark-lighter);
            color: var(--text);
            font-size: 0.9rem;
            min-width: 300px;
        }
        .api-key-bar button {
             padding: 0.5rem 1rem;
             font-size: 0.9rem;
        }

        .nav {
            display: flex; justify-content: center; gap: 1rem;
            padding: 1.5rem; background: var(--dark-lighter); flex-wrap: wrap;
        }
        .nav-btn {
            padding: 0.75rem 1.5rem; background: var(--dark-card); border: 2px solid transparent;
            color: var(--text); cursor: pointer; border-radius: 8px;
            font-size: 1rem; transition: all 0.3s; font-weight: 600;
        }
        .nav-btn:hover {
            background: var(--primary); transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);
        }
        .nav-btn.active { background: var(--primary); border-color: var(--secondary); }

        .container { max-width: 1400px; margin: 2rem auto; padding: 0 1rem; }
        .search-section {
            background: var(--dark-card); padding: 2rem; border-radius: 12px;
            margin-bottom: 2rem; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .search-controls { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .search-input {
            flex: 1; min-width: 250px; padding: 0.75rem; background: var(--dark-lighter);
            border: 2px solid var(--dark); color: var(--text); border-radius: 8px; font-size: 1rem;
        }
        .search-input:focus { outline: none; border-color: var(--primary); }

        .btn {
            padding: 0.75rem 1.5rem; background: var(--primary); border: none;
            color: var(--text); cursor: pointer; border-radius: 8px;
            font-size: 1rem; transition: all 0.3s; font-weight: 600;
        }
        .btn:hover { background: var(--primary-dark); transform: scale(1.05); }
        .btn-secondary { background: var(--secondary); }
        .btn-success { background: var(--success); }
        .btn-small { padding: 0.5rem 1rem; font-size: 0.875rem; }
        .btn:disabled { background: var(--dark-card); color: var(--text-muted); cursor: not-allowed; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem; margin-bottom: 2rem;
        }
        .card {
            background: var(--dark-card); border-radius: 12px; padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); transition: all 0.3s;
            border: 2px solid transparent;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(139, 92, 246, 0.3);
            border-color: var(--primary);
        }
        .card-header {
            display: flex; justify-content: space-between;
            align-items: start; margin-bottom: 1rem;
        }
        .card-title { font-size: 1.5rem; color: var(--primary); margin-bottom: 0.5rem; }
        .card-badge {
            padding: 0.25rem 0.75rem; background: var(--primary);
            border-radius: 20px; font-size: 0.875rem;
            font-weight: 600; white-space: nowrap;
        }
        .card-content { color: var(--text-muted); line-height: 1.6; margin-bottom: 1rem; }
        .card-content p { margin-bottom: 0.5rem; }
        .card-actions { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
        .tag {
            padding: 0.25rem 0.75rem; background: var(--dark-lighter);
            border-radius: 20px; font-size: 0.875rem; border: 1px solid var(--primary);
        }

        /* Modal, Formul√°rios, Mensagens (Sem grandes mudan√ßas) */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000; overflow-y: auto;
        }
        .modal.active { display: flex; justify-content: center; align-items: center; padding: 2rem; }
        .modal-content {
            background: var(--dark-card); padding: 2rem; border-radius: 12px;
            max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto;
        }
        .modal-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 1.5rem;
        }
        .modal-title { font-size: 1.75rem; color: var(--primary); }
        .close-btn {
            background: none; border: none; color: var(--text); font-size: 2rem;
            cursor: pointer; padding: 0; width: 2rem; height: 2rem;
            display: flex; align-items: center; justify-content: center;
        }
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; margin-bottom: 0.5rem; color: var(--text); font-weight: 600; }
        .form-input, .select-input {
            width: 100%; padding: 0.75rem; background: var(--dark-lighter);
            border: 2px solid var(--dark); color: var(--text);
            border-radius: 8px; font-size: 1rem;
        }
        .form-input:focus, .select-input:focus { outline: none; border-color: var(--primary); }
        textarea.form-input { min-height: 100px; resize: vertical; }
        .loading { text-align: center; padding: 2rem; font-size: 1.25rem; color: var(--text-muted); }
        .error-message {
            background: var(--error); color: white; padding: 1rem;
            border-radius: 8px; margin-bottom: 1rem;
        }
        .success-message {
            background: var(--success); color: white; padding: 1rem;
            border-radius: 8px; margin-bottom: 1rem;
        }
        .detail-view { background: var(--dark-card); padding: 2rem; border-radius: 12px; }
        .detail-section { margin-bottom: 1.5rem; }
        .detail-label { color: var(--primary); font-weight: 600; margin-bottom: 0.5rem; }
        .detail-value { color: var(--text-muted); line-height: 1.6; }
        .empty-state { text-align: center; padding: 3rem; color: var(--text-muted); }
        .empty-state h3 { font-size: 1.5rem; margin-bottom: 1rem; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.75rem; }
            .search-controls { flex-direction: column; }
            .grid { grid-template-columns: 1fr; }
            .api-key-bar { flex-direction: column; }
            .api-key-bar input { min-width: auto; width: 100%; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>üé∏ API de Festival (Quarkus)</h1>
    <p>Gerencie Eventos, Artistas e Ingressos</p>
</div>

<div class="api-key-bar">
    <label for="apiKeyInput">API Key:</label>
    <input type="text" id="apiKeyInput" placeholder="Insira sua API Key..." value="demo_key_123456">
    <button class_="btn btn-small" onclick="saveApiKey()">Salvar Chave</button>
</div>

<div class="nav">
    <button class="nav-btn active" onclick="changeSection('eventos')">Eventos</button>
    <button class="nav-btn" onclick="changeSection('artistas')">Artistas</button>
    <button class="nav-btn" onclick="changeSection('ingressos')">Ingressos</button>
</div>

<div class="container">
    <div id="messageContainer"></div>

    <div class="search-section">
        <div class="search-controls">
            <input type="text" id="searchInput" class="search-input" placeholder="Buscar...">
            <button onclick="searchData()" class="btn">üîç Buscar</button>
            <button onclick="clearSearch()" class="btn btn-secondary">‚úñ Limpar</button>
            <button onclick="openCreateModal()" class="btn btn-success">‚ûï Criar Novo</button>
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">Carregando...</div>
    <div id="content" class="grid"></div>

</div>

<div id="modal" class="modal" onclick="closeModalOnBackdrop(event)">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modalTitle">Modal</h2>
            <button class="close-btn" onclick="closeModal()">√ó</button>
        </div>
        <div id="modalBody"></div>
    </div>
</div>

<script>
    // =================================================================
    //                 JAVASCRIPT ADAPTADO PARA API QUARKUS
    // =================================================================

    // -----------------------------------------------------------------
    // ! CONFIGURA√á√ÉO PRINCIPAL !
    // API_BASE aponta para a raiz /api/v1 do seu backend Quarkus
    // API_KEY √© lida da barra de input, com um valor padr√£o
    // -----------------------------------------------------------------
    const API_BASE = 'http://localhost:8080/api/v1';
    let API_KEY = 'demo_key_123456'; // Padr√£o com a chave de teste

    let state = {
        currentSection: 'eventos', // Se√ß√£o inicial
        currentSearch: '',
    };

    // Fun√ß√£o para salvar a API Key do input
    function saveApiKey() {
        API_KEY = document.getElementById('apiKeyInput').value;
        if (API_KEY) {
            showMessage('‚úÖ API Key salva! Carregando dados...', 'success');
            loadData(); // Recarrega os dados com a nova chave
        } else {
            showMessage('‚ùå API Key n√£o pode estar vazia.', 'error');
        }
    }

    // =================================================================
    //           NOVA FUN√á√ÉO: fetchWithAuth
    // =================================================================
    // Todas as chamadas fetch DEVEM passar por aqui
    async function fetchWithAuth(url, options = {}) {
        if (!API_KEY) {
            showMessage('‚ùå Erro: API Key n√£o configurada.', 'error');
            throw new Error('API Key n√£o configurada.');
        }

        // Garante que 'headers' exista
        if (!options.headers) {
            options.headers = {};
        }

        // Adiciona a API Key e o Content-Type (se for POST/PUT)
        options.headers['X-API-Key'] = API_KEY;
        if (options.body) {
            options.headers['Content-Type'] = 'application/json';
        }

        try {
            const response = await fetch(url, options);

            // Trata erros comuns de autentica√ß√£o/autoriza√ß√£o
            if (response.status === 401 || response.status === 403) {
                showMessage('‚ùå Erro de Autentica√ß√£o (401/403). Verifique sua API Key.', 'error');
                throw new Error('N√£o autorizado');
            }

            return response;

        } catch (error) {
            // Trata erros de rede (API offline)
            if (error.message === 'Failed to fetch') {
                showMessage('‚ùå Erro de Rede. A API est√° offline?', 'error');
            }
            throw error;
        }
    }


    function changeSection(section) {
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        state.currentSection = section;
        state.currentSearch = '';
        document.getElementById('searchInput').value = '';

        loadData();
    }

    function searchData() {
        state.currentSearch = document.getElementById('searchInput').value;
        loadData();
    }

    function clearSearch() {
        state.currentSearch = '';
        document.getElementById('searchInput').value = '';
        loadData();
    }

    // =================================================================
    //           FUN√á√ÉO loadData ADAPTADA (SEM PAGINA√á√ÉO)
    // =================================================================
    async function loadData() {
        showLoading(true);

        let url = '';

        if (state.currentSearch) {
            // Endpoints de busca espec√≠ficos da sua API
            const searchEndpoints = {
                eventos: `/eventos/busca/nome/${encodeURIComponent(state.currentSearch)}`,
                artistas: `/artistas/busca/nome/${encodeURIComponent(state.currentSearch)}`,
                ingressos: `/ingressos/busca/email/${encodeURIComponent(state.currentSearch)}`
            };
            url = `${API_BASE}${searchEndpoints[state.currentSection]}`;
        } else {
            // Endpoints padr√£o (lista tudo)
            const endpoints = {
                eventos: '/eventos',
                artistas: '/artistas',
                ingressos: '/ingressos'
            };
            url = `${API_BASE}${endpoints[state.currentSection]}`;
        }

        try {
            const response = await fetchWithAuth(url); // Usa a nova fun√ß√£o
            if (!response.ok) throw new Error('Erro na requisi√ß√£o');

            // A API Quarkus (sem pagina√ß√£o) retorna um array direto
            const data = await response.json();

            displayData(data); // Passa o array direto
        } catch (error) {
            if (error.message !== 'N√£o autorizado') { // Evita msg duplicada
                showMessage('Erro ao carregar dados: ' + error.message, 'error');
            }
            document.getElementById('content').innerHTML = '<div class="empty-state"><h3>Erro ao carregar dados</h3><p>Verifique sua API Key e se a API est√° no ar.</p></div>';
        } finally {
            showLoading(false);
        }
    }

    function displayData(items) {
        const content = document.getElementById('content');
        content.innerHTML = '';

        if (!items || items.length === 0) {
            content.innerHTML = '<div class="empty-state"><h3>Nenhum resultado encontrado</h3><p>Tente ajustar sua busca ou crie um novo item.</p></div>';
            return;
        }

        items.forEach(item => {
            const card = createCard(item, state.currentSection);
            content.appendChild(card);
        });
    }

    // =================================================================
    //           FUN√á√ÉO createCard ADAPTADA PARA QUARKUS
    // =================================================================
    function createCard(item, type) {
        const card = document.createElement('div');
        card.className = 'card';

        if (type === 'eventos') {
            const dataFormatada = item.dataEvento ? new Date(item.dataEvento).toLocaleDateString('pt-BR') : 'Data n√£o definida';

            card.innerHTML = `
                <div class="card-header">
                    <h3 class="card-title">${escapeHtml(item.nome)}</h3>
                    ${item.status ? `<span class="card-badge" style="background: ${item.status === 'ESGOTADO' ? 'var(--error)' : 'var(--primary)'}">${escapeHtml(item.status)}</span>` : ''}
                </div>
                <div class="card-content">
                    <p><strong>Data:</strong> ${dataFormatada}</p>
                    <p><strong>Local:</strong> ${escapeHtml(item.local || 'N/A')}</p>
                    <p><strong>Pre√ßo:</strong> R$ ${item.precoIngresso ? item.precoIngresso.toFixed(2) : '0.00'}</p>
                    <p><strong>Capacidade:</strong> ${item.capacidadeMaxima ? item.capacidadeMaxima.toLocaleString('pt-BR') : 'N/A'}</p>
                </div>
                ${item.artistas && item.artistas.length > 0 ? `
                <div class="card-footer">
                    <span class="tag">${item.artistas.length} artista(s)</span>
                </div>` : ''}
                <div class="card-actions">
                    <button class="btn btn-small" onclick="viewDetails(${item.id}, 'eventos')">üëÅ Ver</button>
                    <button class="btn btn-small btn-secondary" onclick="editItem(${item.id}, 'eventos')">‚úè Editar</button>
                </div>
            `;
            // Bot√£o Deletar removido pois n√£o est√° no README
        } else if (type === 'artistas') {
            card.innerHTML = `
                <div class="card-header">
                    <h3 class="card-title">${escapeHtml(item.nome)}</h3>
                    ${item.generoMusical ? `<span class="card-badge">${escapeHtml(item.generoMusical)}</span>` : ''}
                </div>
                <div class="card-content">
                    <p>${escapeHtml(item.biografia || 'Sem biografia')}</p>
                </div>
                <div class="card-actions">
                    <button class="btn btn-small" onclick="viewDetails(${item.id}, 'artistas')">üëÅ Ver</button>
                    <button class="btn btn-small btn-secondary" onclick="editItem(${item.id}, 'artistas')">‚úè Editar</button>
                </div>
            `;
        } else if (type === 'ingressos') {
            const dataCompraFormatada = item.dataCompra ? new Date(item.dataCompra).toLocaleString('pt-BR') : 'N/A';
            card.innerHTML = `
                <div class="card-header">
                    <h3 class="card-title">Ingresso #${item.id}</h3>
                    ${item.status ? `<span class="card-badge" style="background: ${item.status === 'PAGO' ? 'var(--success)' : 'var(--dark-lighter)'}">${escapeHtml(item.status)}</span>` : ''}
                </div>
                <div class="card-content">
                     <p><strong>Comprador:</strong> ${escapeHtml(item.nomeComprador)}</p>
                     <p><strong>Email:</strong> ${escapeHtml(item.emailComprador)}</p>
                     <p><strong>Qtd:</strong> ${item.quantidade}</p>
                     <p><strong>Total:</strong> R$ ${item.precoTotal ? item.precoTotal.toFixed(2) : '0.00'}</p>
                     <p><strong>Data da Compra:</strong> ${dataCompraFormatada}</p>
                </div>
                <div class="card-actions">
                    <button class="btn btn-small" onclick="viewDetails(${item.id}, 'ingressos')">üëÅ Ver</button>
                    <button class="btn btn-small btn-secondary" onclick="editItem(${item.id}, 'ingressos')">‚úè Editar</button>
                </div>
            `;
        }

        return card;
    }

    async function viewDetails(id, type) {
        const endpoints = {
            eventos: '/eventos',
            artistas: '/artistas',
            ingressos: '/ingressos'
        };

        try {
            const response = await fetchWithAuth(`${API_BASE}${endpoints[type]}/${id}`);
            if (!response.ok) throw new Error('Erro ao carregar detalhes');
            const item = await response.json();

            document.getElementById('modalTitle').textContent = item.nome || `Ingresso #${item.id}`;
            document.getElementById('modalBody').innerHTML = createDetailView(item, type);
            document.getElementById('modal').classList.add('active');
        } catch (error) {
            showMessage('Erro ao carregar detalhes: ' + error.message, 'error');
        }
    }

    // =================================================================
    //           VISUALIZA√á√ÉO DE DETALHES ADAPTADA
    // =================================================================
    function createDetailView(item, type) {
        let html = '<div class="detail-view">';

        if (type === 'eventos') {
            const dataFormatada = item.dataEvento ? new Date(item.dataEvento).toLocaleDateString('pt-BR') : 'N/A';
            html += `
                <div class="detail-section">
                    <div class="detail-label">Nome:</div>
                    <div class="detail-value">${escapeHtml(item.nome)}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Data:</div>
                    <div class="detail-value">${dataFormatada}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Descri√ß√£o:</div>
                    <div class="detail-value">${escapeHtml(item.descricao || 'Sem descri√ß√£o')}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Local:</div>
                    <div class="detail-value">${escapeHtml(item.local || 'N/A')}</div>
                </div>
                 <div class="detail-section">
                    <div class="detail-label">Capacidade / Pre√ßo:</div>
                    <div class="detail-value">${item.capacidadeMaxima.toLocaleString('pt-BR')} pessoas / R$ ${item.precoIngresso.toFixed(2)}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Status:</div>
                    <div class="detail-value">${escapeHtml(item.status)}</div>
                </div>
                ${item.artistas && item.artistas.length > 0 ? `
                <div class="detail-section">
                    <div class="detail-label">Artistas (${item.artistas.length}):</div>
                    <div class="detail-value">${item.artistas.map(a => escapeHtml(a.nome || `ID: ${a.id}`)).join(', ')}</div>
                </div>` : ''}
            `;
        } else if (type === 'artistas') {
            html += `
                <div class="detail-section">
                    <div class="detail-label">Nome:</div>
                    <div class="detail-value">${escapeHtml(item.nome)}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">G√™nero Musical:</div>
                    <div class="detail-value">${escapeHtml(item.generoMusical || 'N/A')}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Biografia:</div>
                    <div class="detail-value">${escapeHtml(item.biografia || 'Sem biografia')}</div>
                </div>
            `;
        } else if (type === 'ingressos') {
             const dataCompraFormatada = item.dataCompra ? new Date(item.dataCompra).toLocaleString('pt-BR') : 'N/A';
            html += `
                <div class="detail-section">
                    <div class="detail-label">Evento:</div>
                    <div class="detail-value">${escapeHtml(item.evento ? item.evento.nome : 'Evento ID: ' + item.eventoId)}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Comprador:</div>
                    <div class="detail-value">${escapeHtml(item.nomeComprador)} (${escapeHtml(item.emailComprador)})</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Data da Compra:</div>
                    <div class="detail-value">${dataCompraFormatada}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Status:</div>
                    <div class="detail-value">${escapeHtml(item.status)}</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Quantidade / Pre√ßo Total:</div>
                    <div class="detail-value">${item.quantidade} / R$ ${item.precoTotal.toFixed(2)}</div>
                </div>
            `;
        }

        html += '</div>';
        return html;
    }

    async function editItem(id, type) {
        const endpoints = {
            eventos: '/eventos',
            artistas: '/artistas',
            ingressos: '/ingressos'
        };

        try {
            const response = await fetchWithAuth(`${API_BASE}${endpoints[type]}/${id}`);
            if (!response.ok) throw new Error('Erro ao carregar item');
            const item = await response.json();

            document.getElementById('modalTitle').textContent = `Editar ${item.nome || `Ingresso #${item.id}`}`;
            document.getElementById('modalBody').innerHTML = createEditForm(item, type, id);
            document.getElementById('modal').classList.add('active');
        } catch (error) {
            showMessage('Erro ao carregar item: ' + error.message, 'error');
        }
    }

    // =================================================================
    //           FORMUL√ÅRIO DE EDI√á√ÉO ADAPTADO
    // =================================================================
    function createEditForm(item, type, id) {
        let html = `<form onsubmit="submitEdit(event, ${id}, '${type}')">`;

        // Pega os IDs dos artistas para o campo de texto
        const artistasIds = item.artistas ? item.artistas.map(a => a.id).join(', ') : '';

        if (type === 'eventos') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome:</label>
                    <input type="text" name="nome" class="form-input" value="${escapeHtml(item.nome || '')}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Data:</label>
                    <input type="date" name="dataEvento" class="form-input" value="${escapeHtml(item.dataEvento || '')}">
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o:</label>
                    <textarea name="descricao" class="form-input">${escapeHtml(item.descricao || '')}</textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Local:</label>
                    <input type="text" name="local" class="form-input" value="${escapeHtml(item.local || '')}">
                </div>
                <div class="form-group">
                    <label class="form-label">Capacidade M√°xima:</label>
                    <input type="number" name="capacidadeMaxima" class="form-input" value="${escapeHtml(item.capacidadeMaxima || '0')}">
                </div>
                <div class="form-group">
                    <label class="form-label">Pre√ßo Ingresso:</label>
                    <input type="number" step="0.01" name="precoIngresso" class="form-input" value="${escapeHtml(item.precoIngresso || '0.00')}">
                </div>
                <div class="form-group">
                    <label class="form-label">IDs dos Artistas (separados por v√≠rgula):</label>
                    <input type="text" name="artistas" class="form-input" value="${artistasIds}">
                </div>
            `;
        } else if (type === 'artistas') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome:</label>
                    <input type="text" name="nome" class="form-input" value="${escapeHtml(item.nome || '')}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">G√™nero Musical:</label>
                    <input type="text" name="generoMusical" class="form-input" value="${escapeHtml(item.generoMusical || '')}">
                </div>
                <div class="form-group">
                    <label class="form-label">Biografia:</label>
                    <textarea name="biografia" class="form-input">${escapeHtml(item.biografia || '')}</textarea>
                </div>
            `;
        } else if (type === 'ingressos') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome Comprador:</label>
                    <input type="text" name="nomeComprador" class="form-input" value="${escapeHtml(item.nomeComprador || '')}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Comprador:</label>
                    <input type="email" name="emailComprador" class="form-input" value="${escapeHtml(item.emailComprador || '')}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Quantidade:</label>
                    <input type="number" name="quantidade" class="form-input" value="${escapeHtml(item.quantidade || '1')}" required>
                </div>
                 <div class="form-group">
                    <label class="form-label">Status:</label>
                    <select name="status" class="select-input" required>
                        <option value="RESERVADO" ${item.status === 'RESERVADO' ? 'selected' : ''}>RESERVADO</option>
                        <option value="PAGO" ${item.status === 'PAGO' ? 'selected' : ''}>PAGO</option>
                        <option value="CANCELADO" ${item.status === 'CANCELADO' ? 'selected' : ''}>CANCELADO</option>
                        <option value="UTILIZADO" ${item.status === 'UTILIZADO' ? 'selected' : ''}>UTILIZADO</option>
                    </select>
                </div>
            `;
        }

        html += `
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button type="submit" class="btn btn-success">üíæ Salvar</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
            </div>
        </form>`;

        return html;
    }

    async function submitEdit(event, id, type) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);

        let data = {};

        // Monta o objeto de dados baseado no tipo
        if (type === 'eventos') {
            const artistasIDs = formData.get('artistas');
            data = {
                nome: formData.get('nome'),
                dataEvento: formData.get('dataEvento') || null,
                descricao: formData.get('descricao') || null,
                local: formData.get('local') || null,
                capacidadeMaxima: parseInt(formData.get('capacidadeMaxima') || 0, 10),
                precoIngresso: parseFloat(formData.get('precoIngresso') || 0.0),
                // Converte a string "1, 2, 3" em [{"id": 1}, {"id": 2}, {"id": 3}]
                artistas: artistasIDs ? artistasIDs.split(',').map(id => ({ id: parseInt(id.trim()) })).filter(a => !isNaN(a.id)) : []
            };
        } else if (type === 'artistas') {
            data = {
                nome: formData.get('nome'),
                generoMusical: formData.get('generoMusical') || null,
                biografia: formData.get('biografia') || null
            };
        } else if (type === 'ingressos') {
            data = {
                nomeComprador: formData.get('nomeComprador'),
                emailComprador: formData.get('emailComprador'),
                quantidade: parseInt(formData.get('quantidade') || 1, 10),
                status: formData.get('status')
            };
        }

        const endpoints = {
            eventos: '/eventos',
            artistas: '/artistas',
            ingressos: '/ingressos'
        };

        try {
            const response = await fetchWithAuth(`${API_BASE}${endpoints[type]}/${id}`, {
                method: 'PUT',
                body: JSON.stringify(data)
            });

            if (response.ok) {
                showMessage('‚úÖ Item atualizado com sucesso!', 'success');
                closeModal();
                loadData();
            } else {
                const errorText = await response.text();
                showMessage(`‚ùå Erro ao atualizar: ${errorText || response.statusText}`, 'error');
            }
        } catch (error) {
            showMessage('‚ùå Erro de conex√£o: ' + error.message, 'error');
        }
    }

    // Deletar n√£o foi implementado pois n√£o estava no README (exceto por uma rota de evento/artista)
    // async function deleteItem(id, type, name) { ... }

    function openCreateModal() {
        const titles = {
            eventos: 'Criar Novo Evento',
            artistas: 'Criar Novo Artista',
            ingressos: 'Comprar Ingresso'
        };

        document.getElementById('modalTitle').textContent = titles[state.currentSection];
        document.getElementById('modalBody').innerHTML = createCreateForm(state.currentSection);
        document.getElementById('modal').classList.add('active');
    }

    // =================================================================
    //           FORMUL√ÅRIO DE CRIA√á√ÉO ADAPTADO
    // =================================================================
    function createCreateForm(type) {
        let html = `<form onsubmit="submitCreate(event, '${type}')">`;

        if (type === 'eventos') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome:</label>
                    <input type="text" name="nome" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Data:</label>
                    <input type="date" name="dataEvento" class="form-input">
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o:</label>
                    <textarea name="descricao" class="form-input"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Local:</label>
                    <input type="text" name="local" class="form-input" placeholder="Ex: Praia de Copacabana">
                </div>
                 <div class="form-group">
                    <label class="form-label">Capacidade M√°xima:</label>
                    <input type="number" name="capacidadeMaxima" class="form-input" value="50000">
                </div>
                <div class="form-group">
                    <label class="form-label">Pre√ßo Ingresso:</label>
                    <input type="number" step="0.01" name="precoIngresso" class="form-input" value="250.00">
                </div>
                <div class="form-group">
                    <label class="form-label">IDs dos Artistas (separados por v√≠rgula):</label>
                    <input type="text" name="artistas" class="form-input" placeholder="Ex: 1, 2, 3">
                </div>
            `;
        } else if (type === 'artistas') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome:</label>
                    <input type="text" name="nome" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">G√™nero Musical:</label>
                    <input type="text" name="generoMusical" class="form-input" placeholder="Ex: Rock, Pop, Eletr√¥nica">
                </div>
                <div class="form-group">
                    <label class="form-label">Biografia:</label>
                    <textarea name="biografia" class="form-input"></textarea>
                </div>
            `;
        } else if (type === 'ingressos') {
            // Baseado no endpoint POST /api/v1/ingressos
            html += `
                <div class="form-group">
                    <label class="form-label">ID do Evento:</label>
                    <input type="number" name="eventoId" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Nome Comprador:</label>
                    <input type="text" name="nomeComprador" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Comprador:</label>
                    <input type="email" name="emailComprador" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Quantidade:</label>
                    <input type="number" name="quantidade" class="form-input" value="1" required>
                </div>
            `;
        }

        html += `
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button type="submit" class="btn btn-success">‚ûï Criar</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
            </div>
        </form>`;

        return html;
    }

    async function submitCreate(event, type) {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);

        let data = {};

        // Monta o objeto de dados baseado no tipo
        if (type === 'eventos') {
            const artistasIDs = formData.get('artistas');
            data = {
                nome: formData.get('nome'),
                dataEvento: formData.get('dataEvento') || null,
                descricao: formData.get('descricao') || null,
                local: formData.get('local') || null,
                capacidadeMaxima: parseInt(formData.get('capacidadeMaxima') || 0, 10),
                precoIngresso: parseFloat(formData.get('precoIngresso') || 0.0),
                artistas: artistasIDs ? artistasIDs.split(',').map(id => ({ id: parseInt(id.trim()) })).filter(a => !isNaN(a.id)) : []
            };
        } else if (type === 'artistas') {
            data = {
                nome: formData.get('nome'),
                generoMusical: formData.get('generoMusical') || null,
                biografia: formData.get('biografia') || null
            };
        } else if (type === 'ingressos') {
            data = {
                nomeComprador: formData.get('nomeComprador'),
                emailComprador: formData.get('emailComprador'),
                quantidade: parseInt(formData.get('quantidade') || 1, 10),
                eventoId: parseInt(formData.get('eventoId'), 10)
            };
        }

        const endpoints = {
            eventos: '/eventos',
            artistas: '/artistas',
            ingressos: '/ingressos'
        };

        try {
            const response = await fetchWithAuth(`${API_BASE}${endpoints[type]}`, {
                method: 'POST',
                body: JSON.stringify(data)
            });

            if (response.ok || response.status === 201) {
                showMessage('‚úÖ Item criado com sucesso!', 'success');
                closeModal();
                loadData();
            } else {
                const errorText = await response.text();
                showMessage(`‚ùå Erro ao criar: ${errorText || response.statusText}`, 'error');
            }
        } catch (error) {
            showMessage('‚ùå Erro de conex√£o: ' + error.message, 'error');
        }
    }

    // =================================================================
    //           FUN√á√ïES UTILIT√ÅRIAS (SEM MODIFICA√á√ÉO)
    // =================================================================

    function closeModal() {
        document.getElementById('modal').classList.remove('active');
    }

    function closeModalOnBackdrop(event) {
        if (event.target.id === 'modal') {
            closeModal();
        }
    }

    function showLoading(show) {
        document.getElementById('loading').style.display = show ? 'block' : 'none';
        document.getElementById('content').style.display = show ? 'none' : 'grid';
    }

    function showMessage(message, type) {
        const container = document.getElementById('messageContainer');
        const div = document.createElement('div');
        div.className = type === 'error' ? 'error-message' : 'success-message';
        div.textContent = message;
        div.style.position = 'relative';
        div.style.animation = 'slideIn 0.3s ease-out';
        container.appendChild(div);

        setTimeout(() => {
            div.style.animation = 'slideOut 0.3s ease-out';
            setTimeout(() => div.remove(), 300);
        }, 7000);
    }

    function escapeHtml(text) {
        if (typeof text !== 'string') return text;
        const map = {
            '&': '&amp;', '<': '&lt;', '>': '&gt;',
            '"': '&quot;', "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }

    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            searchData();
        }
    });

    // Carregamento inicial
    loadData();
</script>
</body>
</html>
